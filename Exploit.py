#!/usr/bin/env python3
from pwn import *
import time
import re

# context.log_level = "debug"
url = "challengecybersec.fr"
port = 6660
r = remote(url, port)
t = int(time.time())
regex = "DGSESIEE{.*?}"


def sockClose():
    r.close()


def Exploit():
    info("Evil cat miaule très fort")
    r.sendafter(":\n", str(t))
    a = r.recvline()
    s = re.findall(regex, str(a))
    if not s:
        warn("Evil cat ne trouve pas son jouet")
    else:
        for answer in s:
            success("Evil cat est content : %s" % str(answer))
            success("Evil cat range sa proie dans Flag.txt")
            f = open("Flag.txt", "w")
            f.write(answer)
            f.close()


info("Evil cat se réveille")
try:
    Exploit()
except:
    warn("Evil cat vient de se casser les dents")
finally:
    info("Evil cat va se coucher")
    sockClose()
